{% extends "crypto/base.html" %}
{% block title %}ðŸ“ˆ Cryptocurrency Market Overview{% endblock %}

{% block extra_head %}
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet" />
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
{% endblock %}

{% block content %}
  <div class="market-overview-body">
    <h1 class="market-overview-h1">ðŸ“ˆ Cryptocurrency Market Overview</h1>

    {% if warning %}
      <p style="color: orange; text-align: center; font-weight: bold;">{{ warning }}</p>
    {% else %}
      <div class="info">
        <strong>Total Coins:</strong> {{ total_coins }}<br />
        <strong>Top Coin:</strong> {{ top_coin }}<br />
        <strong>Source:</strong> {{ source }}
      </div>

      <div class="chart-container">
        <h2 class="market-overview-h2">Top 10 Cryptocurrencies by Current Price</h2>
        <div id="top10-chart"></div>
      </div>

      <div class="chart-container">
        <h2 class="market-overview-h2">6 Worst Performing Cryptocurrencies (24h % Change)</h2>
        <div id="worst6-chart"></div>
      </div>

      <h2 class="market-overview-h2">ðŸ“‹ Simplified Data View</h2>
      <div>
        {{ table_html|safe }}
      </div>
    {% endif %}
  </div>
{% endblock %}

{% block extra_js %}
  <script>
    const top10 = JSON.parse('{{ top_10_chart|escapejs }}');
    const worst6 = JSON.parse('{{ worst_6_chart|escapejs }}');

    // Apply dynamic, vibrant colors and style layouts

    // Top10 chart colorscale & styling
    top10.data.forEach(trace => {
      trace.marker = {
        color: trace.y,
        colorscale: 'Viridis',  // prueba 'Viridis', 'Turbo', 'Jet', 'Cividis'
        size: 12,
        showscale: true,
        line: { color: '#fff', width: 1 }
      };
      if(trace.type === 'bar') {
        trace.marker.line.width = 2;
      }
    });
    top10.layout = {
      ...top10.layout,
      plot_bgcolor: '#302b63',
      paper_bgcolor: '#302b63',
      font: { color: '#fff', family: 'Montserrat, sans-serif' },
      margin: { t: 50, b: 50, l: 60, r: 40 },
      xaxis: { showgrid: false },
      yaxis: { showgrid: true, gridcolor: 'rgba(255,255,255,0.15)' }
    };

    // Worst6 chart colorscale & styling
    worst6.data.forEach(trace => {
      trace.marker = {
        color: trace.y,
        colorscale: 'Turbo',
        line: { color: 'rgba(255,255,255,0.7)', width: 1.5 }
      };
    });
    worst6.layout = {
      ...worst6.layout,
      plot_bgcolor: '#302b63',
      paper_bgcolor: '#302b63',
      font: { color: '#fff', family: 'Montserrat, sans-serif' },
      margin: { t: 50, b: 50, l: 60, r: 40 },
      xaxis: { showgrid: false },
      yaxis: { showgrid: true, gridcolor: 'rgba(255,255,255,0.15)' }
    };

    Plotly.newPlot('top10-chart', top10.data, top10.layout);
    Plotly.newPlot('worst6-chart', worst6.data, worst6.layout);
  </script>
{% endblock %}
